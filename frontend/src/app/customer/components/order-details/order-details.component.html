<div class="fade-in">
  <!-- Back Button -->
  <div class="mb-4">
    <button class="btn btn-outline-secondary" (click)="trackAnotherOrder()">
      <i class="fas fa-arrow-left me-2"></i>Track Another Order
    </button>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-3">Loading order details...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="errorMessage && !isLoading" class="alert alert-danger">
    <i class="fas fa-exclamation-triangle me-2"></i>
    {{ errorMessage }}
  </div>

  <!-- Order Details -->
  <div *ngIf="orderDetails && !isLoading" class="fade-in">
    <!-- Header Card -->
    <!-- Header Card -->
    <div class="card fade-in">
      <div class="card-header d-flex justify-content-between align-items-center">
        <div>
          <h4 class="mb-1">
            Order Details
          </h4>
          <small class="text-white opacity-75">Last updated: {{ lastUpdated }}</small>
        </div>
        <div class="form-check form-switch form-check-reverse">
          <input class="form-check-input" type="checkbox" role="switch" id="autoRefresh"
            [(ngModel)]="autoRefreshEnabled" (change)="toggleAutoRefresh()">
          <label class="form-check-label text-white small fw-bold" for="autoRefresh">
            Auto-refresh
          </label>
        </div>
      </div>
      <div class="card-body">

        <!-- Top Status Row -->
        <div class="d-flex justify-content-between align-items-start mb-5 flex-wrap gap-3">
          <div>
            <span class="detail-label d-block">Current Status</span>
            <div class="status-badge mt-2"
              [ngClass]="'bg-' + getStatusColor(orderDetails.status) + '-subtle text-' + getStatusColor(orderDetails.status)">
              <!-- Note: Bootstrap 5.3 has bg-*-subtle. If not available, we might need custom classes. 
                    Let's stick to simple backgrounds defined in CSS or inline style for now if subtle isn't there, 
                    but since we have custom CSS for badges, let's use that. -->
              <i class="fas fa-{{ getStatusIcon(orderDetails.status) }} me-2"></i>
              {{ getStatusText(orderDetails.status) }}
            </div>
          </div>
          <div class="text-end">
            <span class="detail-label d-block">Estimated Delivery</span>
            <span class="detail-value text-primary fs-4">{{ orderDetails.estimatedDelivery }}</span>
          </div>
        </div>

        <hr class="text-muted opacity-25 mb-5">

        <!-- Grid Layout for Details -->
        <div class="tracking-grid">
          <div class="detail-item">
            <span class="detail-label">Tracking ID</span>
            <span class="tracking-id-value">{{ orderDetails.trackingId }}</span>
          </div>

          <div class="detail-item">
            <span class="detail-label">Customer</span>
            <span class="detail-value">{{ orderDetails.customerName }}</span>
          </div>

          <div class="detail-item">
            <span class="detail-label">Company Name</span>
            <span class="detail-value">{{ orderDetails.companyName || 'Not Specified' }}</span>
          </div>

          <div class="detail-item">
            <span class="detail-label">Company Address</span>
            <span class="detail-value">{{ orderDetails.companyAddress || 'Not Specified' }}</span>
          </div>

          <div class="detail-item">
            <span class="detail-label">Item</span>
            <span class="detail-value">{{ orderDetails.itemName }}</span>
          </div>

          <div class="detail-item">
            <span class="detail-label">Order Date</span>
            <span class="detail-value">{{ formatDate(orderDetails.orderDate) }}</span>
          </div>

          <div class="detail-item">
            <span class="detail-label">Location</span>
            <span class="detail-value">{{ orderDetails.currentLocation }}</span>
          </div>
        </div>

      </div>
    </div>

    <!-- Progress Tracker -->
    <div class="card shadow mb-4">
      <div class="card-header">
        <h5 class="mb-0">
          <i class="fas fa-road me-2"></i>Order Journey
        </h5>
      </div>
      <div class="card-body">
        <!-- Progress Bar -->
        <div class="progress mb-4" style="height: 10px;">
          <div class="progress-bar bg-success" role="progressbar" [style.width.%]="getProgressPercentage()">
          </div>
        </div>

        <!-- Progress Steps -->
        <div class="row text-center">
          <div *ngFor="let step of progressSteps; let i = index" class="col">
            <div class="step-container" [class.active]="i <= getActiveStepIndex()">
              <div class="step-icon">
                <i [class]="step.icon"></i>
              </div>
              <div class="step-label mt-2">
                <small class="fw-bold">{{ step.label }}</small>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Timeline -->
    <div class="card shadow mb-4">
      <div class="card-header">
        <h5 class="mb-0">
          <i class="fas fa-history me-2"></i>Order Timeline
        </h5>
      </div>
      <div class="card-body">
        <div class="timeline">
          <div class="timeline-item">
            <div class="timeline-icon bg-primary">
              <i class="fas fa-shopping-cart"></i>
            </div>
            <div class="timeline-content">
              <h6>Order Placed</h6>
              <p class="text-muted small">{{ formatDate(orderDetails.orderDate) }}</p>
            </div>
          </div>

          <div *ngIf="orderDetails.status !== 'PROCESSING'" class="timeline-item">
            <div class="timeline-icon bg-success">
              <i class="fas fa-check"></i>
            </div>
            <div class="timeline-content">
              <h6>Order Confirmed</h6>
              <p class="text-muted small">Your order has been confirmed</p>
            </div>
          </div>

          <div *ngIf="['DISPATCHED', 'IN_TRANSIT', 'OUT_FOR_DELIVERY', 'DELIVERED'].includes(orderDetails.status)"
            class="timeline-item">
            <div class="timeline-icon bg-info">
              <i class="fas fa-truck-loading"></i>
            </div>
            <div class="timeline-content">
              <h6>Order Dispatched</h6>
              <p class="text-muted small">Your order has left our warehouse</p>
            </div>
          </div>

          <div *ngIf="['IN_TRANSIT', 'OUT_FOR_DELIVERY', 'DELIVERED'].includes(orderDetails.status)"
            class="timeline-item">
            <div class="timeline-icon bg-warning">
              <i class="fas fa-shipping-fast"></i>
            </div>
            <div class="timeline-content">
              <h6>In Transit</h6>
              <p class="text-muted small">Your order is on the way</p>
            </div>
          </div>

          <div *ngIf="['OUT_FOR_DELIVERY', 'DELIVERED'].includes(orderDetails.status)" class="timeline-item">
            <div class="timeline-icon bg-primary">
              <i class="fas fa-truck"></i>
            </div>
            <div class="timeline-content">
              <h6>Out for Delivery</h6>
              <p class="text-muted small">Your order will be delivered today</p>
            </div>
          </div>

          <div *ngIf="orderDetails.status === 'DELIVERED'" class="timeline-item">
            <div class="timeline-icon bg-success">
              <i class="fas fa-home"></i>
            </div>
            <div class="timeline-content">
              <h6>Delivered</h6>
              <p class="text-muted small">Your order has been delivered</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Notes Section -->
    <div *ngIf="orderDetails.notes" class="card shadow">
      <div class="card-header bg-light">
        <h5 class="mb-0">
          <i class="fas fa-sticky-note me-2"></i>Additional Notes
        </h5>
      </div>
      <div class="card-body">
        <div class="alert alert-info mb-0">
          <i class="fas fa-info-circle me-2"></i>
          {{ orderDetails.notes }}
        </div>
      </div>
    </div>
  </div>

  <!-- Share Section -->
  <div class="mt-4 text-center">
    <p class="text-muted">Share this tracking page:</p>
    <div class="btn-group" role="group">
      <button class="btn btn-outline-primary">
        <i class="fas fa-link me-2"></i>Copy Link
      </button>
      <button class="btn btn-outline-success">
        <i class="fas fa-envelope me-2"></i>Email
      </button>
      <button class="btn btn-outline-info">
        <i class="fas fa-sms me-2"></i>SMS
      </button>
    </div>
  </div>
</div>